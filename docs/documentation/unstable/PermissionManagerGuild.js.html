<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: PermissionManagerGuild.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: PermissionManagerGuild.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Discord = require('discord.js');
const PermissionManagerRole = require('./PermissionManagerRole');
const util = require('util');

const wait = util.promisify(setTimeout);

/**
 * 
 */
class PermissionManagerGuild {
  /**
   * @param {Discord.Guild} [guild]
   */
  constructor(guild, timeout = null) {
    if (guild) {
      /**
       * The Guild ID used to identify it
       * @type {String}
       */
      this.guild = guild.id;

      /**
       * A collection of roles
       * @type {Map&lt;String, PermissionManagerRole>}
       */
      this.roles = {};

      /**
       * A little list of role ID's in order by position in the guild settings
       * @type {String[]}
       */
      this.friendlyRoleIndex = [];

      /**
       * The permissions and roles that have them
       */
      this.perms = {};
      for (const [k,v] of guild.roles.cache) {
        this.roles[k] = new PermissionManagerRole(v);
        this.friendlyRoleIndex[v.position] = k;
      };

      this.dies = false;
      if (timeout) {
        this.dies = true;
        this.timeout = timeout;
        this._startTimeout();
      }

      this.signals = new EventEmitter();
    }
  }
  setTimeout(timeout) {
    this.timeout = timeout;
  }
  _startTimeout() {
    if (dies) this.timeoutTimer = setTimeout(this.die, this.timeout);
  }
  _resetTimeout() {
    if (dies) {
      clearTimeout(this.timeoutTimer);
      this._startTimeout();
    }
  }
  /**
   * Set a permission to a specific value for a role
   * @param {Discord.Role | Discord.Snowflake | String} [role]
   * @param {String} [perm]
   * @param {Boolean} [value=true]
   */
  setPermission(role, perm, value = true) {
    var r = '0';
    if (role instanceof Discord.Role) {
      r = role.id;
    } else {
      r = role;
    }
    this.roles[r].setPerm(perm, value);
    if (this.perms[perm] == null) {
      this.perms[perm] = [];
    }
    this.perms[perm].push(r);
    this._resetTimeout();
  }

  /**
   * Gets a permission for a member
   * @param {Discord.GuildMember} [member]
   * @param {String} [perm]
   * @returns {Boolean}
   */
  getPermission(member, perm) {
    this._resetTimeout();
    return member._roles.some(r=> this.perms[perm].includes(r));
  }

  die() {
    this.signals.emit('die');
  }
}

module.exports = PermissionManagerGuild;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="PermissionManager.html">PermissionManager</a></li><li><a href="PermissionManagerGuild.html">PermissionManagerGuild</a></li><li><a href="PermissionManagerRole.html">PermissionManagerRole</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sun Nov 01 2020 17:14:27 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
